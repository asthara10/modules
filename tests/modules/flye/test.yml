# According to the issue https://github.com/fenderglass/Flye/issues/164
# Some fluctuations are expected because of the heuristics
# Here we check the statistics of the main contig

- name: flye test_flye_pacbio_raw
  command: nextflow run ./tests/modules/flye -entry test_flye_pacbio_raw -c ./tests/config/nextflow.config  -c ./tests/modules/flye/nextflow.config
  tags:
    - flye
  files:
    - path: output/flye/test.assembly.fasta.gz
    - path: output/flye/test.assembly_graph.gfa.gz
    - path: output/flye/test.assembly_graph.gv.gz
    - path: output/flye/test.assembly_info.txt
      contains_regex:
      - "contig_1 +212586 +6 +N +N +1 +\\* +\\*,1,\\*"
    - path: output/flye/test.flye.log
    - path: output/flye/test.params.json
      md5sum: 54b576cb6d4d27656878a7fd3657bde9

- name: flye test_flye_pacbio_corr
  command: nextflow run ./tests/modules/flye -entry test_flye_pacbio_corr -c ./tests/config/nextflow.config  -c ./tests/modules/flye/nextflow.config
  tags:
    - flye
  files:
    - path: output/flye/test.assembly.fasta.gz
    - path: output/flye/test.assembly_graph.gfa.gz
    - path: output/flye/test.assembly_graph.gv.gz
    - path: output/flye/test.assembly_info.txt
      contains_regex:
      - "contig_1 +212866 +6 +N +N +1 +\\* +\\*,1,\\*"
    - path: output/flye/test.flye.log
    - path: output/flye/test.params.json
      md5sum: 54b576cb6d4d27656878a7fd3657bde9

- name: flye test_flye_pacbio_hifi
  command: nextflow run ./tests/modules/flye -entry test_flye_pacbio_hifi -c ./tests/config/nextflow.config  -c ./tests/modules/flye/nextflow.config
  tags:
    - flye
  files:
    - path: output/flye/test.assembly.fasta.gz
    - path: output/flye/test.assembly_graph.gfa.gz
    - path: output/flye/test.assembly_graph.gv.gz
    - path: output/flye/test.assembly_info.txt
      contains_regex:
      - "contig_1 +58065 +7 +N +N +1 +\\* +\\*,1,\\*"
    - path: output/flye/test.flye.log
    - path: output/flye/test.params.json
      md5sum: 54b576cb6d4d27656878a7fd3657bde9

- name: flye test_flye_nano_raw
  command: nextflow run ./tests/modules/flye -entry test_flye_nano_raw -c ./tests/config/nextflow.config  -c ./tests/modules/flye/nextflow.config
  tags:
    - flye
  files:
    - path: output/flye/test.assembly.fasta.gz
    - path: output/flye/test.assembly_graph.gfa.gz
    - path: output/flye/test.assembly_graph.gv.gz
    - path: output/flye/test.assembly_info.txt
      contains_regex:
      - "contig_1 +212702 +6 +N +N +1 +\\* +\\*,1,\\*"
    - path: output/flye/test.flye.log
    - path: output/flye/test.params.json
      md5sum: 54b576cb6d4d27656878a7fd3657bde9

- name: flye test_flye_nano_corr
  command: nextflow run ./tests/modules/flye -entry test_flye_nano_corr -c ./tests/config/nextflow.config  -c ./tests/modules/flye/nextflow.config
  tags:
    - flye
  files:
    - path: output/flye/test.assembly.fasta.gz
    - path: output/flye/test.assembly_graph.gfa.gz
    - path: output/flye/test.assembly_graph.gv.gz
    - path: output/flye/test.assembly_info.txt
      contains_regex:
      - "contig_1 +212956 +6 +N +N +1 +\\* +\\*,1,\\*"
    - path: output/flye/test.flye.log
    - path: output/flye/test.params.json
      md5sum: 54b576cb6d4d27656878a7fd3657bde9

- name: flye test_flye_nano_hq
  command: nextflow run ./tests/modules/flye -entry test_flye_nano_hq -c ./tests/config/nextflow.config  -c ./tests/modules/flye/nextflow.config
  tags:
    - flye
  files:
    - path: output/flye/test.assembly.fasta.gz
    - path: output/flye/test.assembly_graph.gfa.gz
    - path: output/flye/test.assembly_graph.gv.gz
    - path: output/flye/test.assembly_info.txt
      contains_regex:
      - "contig_1 +212953 +6 +N +N +1 +\\* +\\*,1,\\*"
    - path: output/flye/test.flye.log
    - path: output/flye/test.params.json
      md5sum: 54b576cb6d4d27656878a7fd3657bde9
